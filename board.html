<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Foync 数据看板</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-white flex flex-col items-center justify-center min-h-screen p-4 font-sans">
    <div class="space-y-8 text-center w-full max-w-lg">
        
        <div class="bg-slate-900/50 p-8 rounded-3xl backdrop-blur-md border border-slate-800 shadow-2xl">
            <div id="time" class="text-7xl font-mono font-black tracking-tighter text-blue-500">00:00:00</div>
            <div id="date" class="text-lg text-slate-500 mt-2 font-mono uppercase tracking-widest text-slate-400">Loading...</div>
        </div>
        
        <div class="bg-slate-900 border border-slate-800 p-8 rounded-3xl shadow-2xl">
            <h3 class="text-slate-500 text-xs uppercase tracking-[0.2em] mb-4 font-bold">Location & Weather</h3>
            <div id="location" class="text-2xl font-bold text-slate-200 mb-1">定位中...</div>
            <div id="weather" class="text-4xl font-mono text-emerald-400 font-bold italic mb-8">Loading...</div>

            <div class="pt-6 border-t border-slate-800/50">
                <p class="text-[10px] text-slate-500 mb-3 uppercase tracking-[0.1em]">搜索地区 (支持拼音/港澳台城市)</p>
                <div class="flex gap-2">
                    <input id="cityInput" list="citySuggestions" oninput="getSuggestions(this.value)"
                           type="text" placeholder="输入城市, 如: Taipei" 
                           class="bg-black/50 border border-slate-700 rounded-xl px-4 py-2 text-sm flex-1 outline-none focus:border-blue-500 transition-all">
                    
                    <datalist id="citySuggestions">
                        <option value="Beijing">北京</option>
                        <option value="Shanghai">上海</option>
                        <option value="Guangzhou">广州</option>
                        <option value="Shenzhen">深圳</option>
                        <option value="Hong Kong">香港</option>
                        <option value="Zhengzhou">郑州</option>
                        <option value="Macau">澳门</option>
                        <option value="Taipei">台北</option>
                        <option value="Kaohsiung">高雄</option>
                        <option value="Taichung">台中</option>
                        <option value="Hangzhou">杭州</option>
                        <option value="Chengdu">成都</option>
                        <option value="Chongqing">重庆</option>
                    </datalist>

                    <button onclick="applyUserCity()" 
                            class="bg-blue-600 hover:bg-blue-500 active:scale-95 text-white text-xs px-5 py-2 rounded-xl font-bold transition-all shadow-lg">
                        应用
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 1. 时钟逻辑
        function updateClock() {
            const now = new Date();
            document.getElementById('time').innerText = now.toLocaleTimeString('zh-CN', { hour12: false });
            document.getElementById('date').innerText = now.toLocaleDateString('zh-CN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }
        setInterval(updateClock, 1000);
        updateClock();

        // 2. 预测联想优化
        async function getSuggestions(input) {
            if (input.length < 2) return;
            try {
                // 调用 API 获取全球城市，补充内置列表
                const res = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${input}&count=5&language=zh&format=json`);
                const data = await res.json();
                const datalist = document.getElementById('citySuggestions');
                
                // 保留内置的核心城市，动态添加新结果
                if (data.results) {
                    const newOptions = data.results.map(item => `<option value="${item.name}">${item.country || ''}</option>`).join('');
                    // 这里不直接重写 innerHTML，而是保留内置核心城市
                    if(!datalist.dataset.baseSet) {
                        datalist.dataset.baseSet = datalist.innerHTML;
                    }
                    datalist.innerHTML = datalist.dataset.baseSet + newOptions;
                }
            } catch (e) { console.log("Suggestion link failed"); }
        }

        // 3. 应用设置
        function applyUserCity() {
            const inputVal = document.getElementById('cityInput').value.trim();
            localStorage.setItem('user_selected_city', inputVal);
            fetchWeather(inputVal);
        }

        // 4. 天气逻辑
        async function fetchWeather(manualCity) {
            const locEl = document.getElementById('location');
            const weaEl = document.getElementById('weather');
            const targetCity = manualCity !== undefined ? manualCity : (localStorage.getItem('user_selected_city') || "");
            document.getElementById('cityInput').value = targetCity;

            try {
                // wttr.in 对中文地名支持较好，只要输入正确拼音或英文名
                const response = await fetch(`https://wttr.in/${targetCity}?format=%l:%C:%t`);
                const text = await response.text();
                if (!text || text.includes("Unknown")) throw new Error();

                const parts = text.split(':');
                locEl.innerText = parts[0]; 
                weaEl.innerText = `${parts[1]} ${parts[2]}`;
            } catch (e) {
                locEl.innerText = "未找到该地区";
                weaEl.innerText = "N/A";
            }
        }
        fetchWeather();
    </script>
</body>
</html>